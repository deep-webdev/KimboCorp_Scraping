{% comment %} {% load staticfiles %} {% endcomment %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    {% comment %} {% load static %} {% endcomment %}
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Products</title>
    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.css"
    />
    <link rel="stylesheet" href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/datetime/1.1.0/css/dataTables.dateTime.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.0.1/css/bootstrap.min.css">


    <!--css-->
    <link rel="stylesheet" href="{% static 'css/index.css'%}" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.12.1/js/dataTables.bootstrap5.min.js"></script>

    <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"
    ></script>
    <!--font awsome-->
    <script
      src="https://kit.fontawesome.com/f7b1e488bc.js"
      crossorigin="anonymous"
    ></script>

    
    <script>
      $(document).ready(function () {
          var table = $('#example').DataTable();
        });
        </script>

      <script>
        function calculate(){
          fees = document.getElementById('fees').value;
          cms = document.getElementById('cms').value;
          $body = $("body");

          $.ajax({
            url: "{% url 'crypto_price' %}",
            type: 'POST',
            cache: false,
            beforeSend:function() { $body.addClass("loading"); },
            processData: false,
            contentType: false,
            success: function(data) {
              console.log(data.bitcoin.usd);
              var table = $('#example').DataTable({retrieve: true,})  
              
              table.rows().every( function ( rowIdx, tableLoop, rowLoop ) {
                var t_data = this.data();
                final_price = t_data[1] * ( 1 + fees/100 + cms/100);
                btc_price = final_price/(data.bitcoin.usd);
                eth_price = final_price/data.ethereum.usd;
                th_price = final_price/data.tether.usd;
                t_data[7] =  final_price.toFixed(2); 
                t_data[8] = btc_price.toFixed(2);
                t_data[9] = eth_price.toFixed(2);
                t_data[10] = th_price.toFixed(2);
                this.data(t_data)
             } )
            }
            ,
                complete:function () {
                    $body.removeClass("loading");
                }
            ,
                error:function () {
                    alert("There is some problem occurred while processing your request !!");
                }    
              });

        }

      </script>
    <style>
      label{display:inline-block;}
      input{display:block;}

    </style>
    </head>

  <body>
    
    <!--Navbar-->
    <nav class="navbar navbar-expand-lg bg-dark navbar-dark py-3" id="Navbar">
      <!-- content set for navbar -->
      <div class="container" id="navbar">
        <a href="#" class="brandName navbar-brand">
            <img src="/media/gold-bars.png" width="60" height="60" alt=""
                class="d-inline-block align-text-middle" /><span class="px-3" href="../index.html">Gold Data</span>
        </a>
    
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navmenu">
            <span class="navbar-toggler-icon"></span>
        </button>
    
        <div class="collapse navbar-collapse" id="navmenu">
          <ul class="navbar-nav ms-auto">
              <li class="nav-item">
                  <a href="{% url 'home' %}" class="nav-link">Extracted</a>
              </li>
              <li class="nav-item">
                  <a href="{% url 'products' %}" class="nav-link">Products</a>
              </li>
              <li class="nav-item">
                  <a href=".{% url 'all_prod' %}" class="nav-link">All Products</a>
              </li>
          </ul>
      </div>
  </div>
    </nav>

    <!--Explore Section -->
    <section
      class="bg-dark text-light p-5 pt-md-0 pt-lg-5 text-center text-sm-start"
    >
      <div class="container">
        <div class="row align-items-center justify-content-between">
          <div class="col-lg-8 col-md-8 col-sm-12">
            <h1>
              Explore your <span class="text-warning"> Golden Data here </span>
            </h1>
            <p class="lead my-4">
              Lorem ipsum dolor sit amet consectetur adipisicing elit. Mollitia,
              ullam excepturi quibusdam quidem, repudiandae obcaecati et, illum
              facere tempore suscipit quae nobis harum aut assumenda similique
              debitis cumque totam id!
            </p>
            <a class="btn btn-warning btn-lg" href="./allProducts.html">
              All Products
            </a>
          </div>
          <!-- Right side animated bar -->
          <div
            class="logo-holder d-none d-lg-block image-header img-fluid col-lg-4 col-md-4 col-sm-6 mb-4"
          >
            <div class="bg"></div>
            <div class="bar"></div>
            <div class="bar fill1"></div>
            <div class="bar fill2"></div>
            <div class="bar fill3"></div>
            <div class="bar fill4"></div>
            <div class="bar fill1"></div>
            <div class="bar fill5"></div>
            <div class="bar fill6"></div>
            <div class="bar"></div>
          </div>
        </div>
      </div>
    </section>

    <h3 class="text-center pt-5">All The Products</h3>
    <div class="container pt-3">
      <div style="float:Center;margin:20px">

      <label>Fees<input type="number" name="fees" id="fees" value="0.8"/></label>
      <label>Commission<input type="number" name="cms" id="cms" value="0.5"/></label>
      
      <input type="button" class="btn btn-primary" name="Calculate" value="Calculate" onclick="calculate()"/>
      </div>
      <table
        class="table display responsive"
        id="example"
      >
        <thead id="example" class="alert alert-warning">
          <!--Table columns go here-->
          <tr>
            {% comment %} <th>Product Id</th> {% endcomment %}

            <th>Product Name</th>
            <th>Price (USD)</th>
            <th>Weight</th>
            <th>Purity</th>
            <th>Manufacture</th>
            <th>Premium %</th>
            <th>Stock</th>
            <th>Premium(%)</th>
            <th>Final Price</th>
            <th>Bitcoin Price</th>
            <th>Ethereum Price</th>
            <th>Tether Price</th>
            {% comment %} <th>Product URL</th> {% endcomment %}
            <th>Supplier Country</th>
        </tr>
        </thead>
        <tbody id="tableBody">
          <!-- Table rows go here -->
          {% for i in data %}
          <tr>
            {% comment %} <td> {{ i.product_id }} </td> {% endcomment %}

               <td><a href="{{ i.product_url }}" >{{ i.product_name }} </a> </td>
               <td> {{ i.price_usd }} </td>
               <td> {{ i.weight }} </td>
               <td> {{ i.purity }} </td>
               <td> {{ i.manufacture }} </td>
               <td>{{ i.premium }}</td>
               <td>{{ i.stock }}</td>
               <th>{{ i.Final_Price|floatformat:2 }}</th>
               <th>{{ i.Bitcoin_Price|floatformat:2 }}</th>
               <th>{{ i.Ethereum_Price|floatformat:2 }}</th>
               <th>{{ i.Tether_Price|floatformat:2 }}</th>
   
               {% comment %} <td><a href="{{ i.product_url }}" >{{ i.product_url|slice:":10" }} </a></td> {% endcomment %}
               <td> {{ i.supplier_country }} </td>

          </tr>
   {% endfor %}
        </tbody>

      </table>
    </div>

    <!--Footer-->
    <footer
      class="container-fluid text-center bg-dark mt-5 footer position-relative"
    >
    <div class="text-light p-4">Gold Data Scraping</div>
  </footer>
  </body>
  <!-- scripts -->
  {% comment %} <script type="module" src={% static 'js/index.js %}></script> {% endcomment %}
</html>
